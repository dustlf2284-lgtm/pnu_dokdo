<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë…ë„ ì—­ì‚¬ ì•„ì¹´ì´ë¸Œ ë° ë¶„ì„ (Dokdo History Archives)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fdfbf7; /* Warm Paper Background */
            color: #1f2937;
        }
        
        .serif-font {
            font-family: 'Noto Serif KR', serif;
        }

        /* Custom Scrollbar for the list container */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Chart Container Constraint Class */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Constraint width */
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Base height */
            max-height: 350px;
        }
        
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        .timeline-line {
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e2e8f0;
            z-index: 0;
        }
    </style>
    <!-- Chosen Palette: Warm Neutral Background (#fdfbf7), Ocean Blue Primary (#1e3a8a), Historical Red Accent (#991b1b), Slate Text -->
    <!-- Application Structure Plan: Dashboard layout. Top section for aggregate analysis (Charts) to give context. Bottom section split into Interactive Timeline (Left) and Detail View (Right). Designed to allow users to first understand the 'shape' of history via data, then explore specific events chronologically. -->
    <!-- Visualization & Content Choices: 
         1. Timeline Frequency Chart (Bar): Goal: Show historical activity density. Method: Chart.js Bar. Interaction: Visual only.
         2. Evidence Origin Chart (Doughnut): Goal: Categorize sources (KR vs JP vs Intl). Method: Chart.js Doughnut. Interaction: Legend click.
         3. Interactive Timeline List: Goal: Exploration. Method: Tailwind styled list with JS click handlers.
         4. Detail Card: Goal: Deep dive. Method: Dynamic HTML update based on selection.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-[#1e3a8a] text-white py-6 shadow-md">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold serif-font tracking-wide">ë…ë„ ì—­ì‚¬ ì•„ì¹´ì´ë¸Œ</h1>
                <p class="text-blue-200 text-sm mt-1">Dokdo History Archives & Analytics</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="hidden md:block text-right">
                    <span class="text-xs bg-blue-800 px-3 py-1 rounded-full">Historical Data Analysis</span>
                </div>
                <a href="index.html" class="flex items-center gap-2 bg-blue-800 hover:bg-blue-700 border border-blue-700 px-3 py-1.5 rounded-lg transition-colors text-sm shadow-sm">
                    <span>ğŸ </span>
                    <span class="font-medium">Home</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 space-y-8">

        <!-- Intro Section -->
        <section class="bg-white rounded-lg p-6 card-shadow border-l-4 border-[#1e3a8a]">
            <h2 class="text-xl font-bold mb-2 text-gray-800">ì—­ì‚¬ì  ë§¥ë½ê³¼ ë°ì´í„° (Historical Context)</h2>
            <p class="text-gray-600 leading-relaxed">
                ë³¸ ì•„ì¹´ì´ë¸ŒëŠ” 1454ë…„ <span class="font-semibold">ì„¸ì¢…ì‹¤ë¡ì§€ë¦¬ì§€</span>ë¶€í„° 2011ë…„ ì¼ë³¸ êµê³¼ì„œ ì™œê³¡ ë…¼ë€ê¹Œì§€, ë…ë„ì™€ ê´€ë ¨ëœ ì£¼ìš” ì—­ì‚¬ì  ì‚¬ê±´ê³¼ ë¬¸í—Œì„ ì§‘ëŒ€ì„±í–ˆìŠµë‹ˆë‹¤. 
                ì•„ë˜ì˜ ëŒ€ì‹œë³´ë“œë¥¼ í†µí•´ ì‹œëŒ€ë³„ ì‚¬ê±´ì˜ ë¹ˆë„ì™€ ì¦ê±°ì˜ ìœ í˜•ì„ ë¶„ì„í•˜ê³ , ì¸í„°ë™í‹°ë¸Œ íƒ€ì„ë¼ì¸ì„ í†µí•´ ê°œë³„ ì‚¬ê±´ì˜ ìƒì„¸ ë‚´ìš©ì„ íƒêµ¬í•´ ë³´ì‹­ì‹œì˜¤.
                ì´ ìë£ŒëŠ” ë…ë„ê°€ ì—­ì‚¬ì , ì§€ë¦¬ì , êµ­ì œë²•ì ìœ¼ë¡œ ëŒ€í•œë¯¼êµ­ì˜ ê³ ìœ  ì˜í† ì„ì„ ë³´ì—¬ì£¼ëŠ” íë¦„ì„ ì‹œê°í™”í•©ë‹ˆë‹¤.
            </p>
        </section>

        <!-- Dashboard Section: Charts -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Chart 1: Temporal Distribution -->
            <div class="bg-white p-6 rounded-lg card-shadow">
                <div class="mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <span>ğŸ“Š</span> ì‹œëŒ€ë³„ ì‚¬ê±´ ë¹ˆë„ ë¶„ì„
                    </h3>
                    <p class="text-sm text-gray-500">ì–´ëŠ ì‹œê¸°ì— ë…ë„ ê´€ë ¨ ì´ìŠˆë‚˜ ê¸°ë¡ì´ ì§‘ì¤‘ë˜ì—ˆëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                </div>
                <div class="chart-container">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>

            <!-- Chart 2: Source Type Analysis -->
            <div class="bg-white p-6 rounded-lg card-shadow">
                <div class="mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <span>ğŸ“‘</span> ê¸°ë¡ ë° ì‚¬ê±´ ìœ í˜• ë¶„ì„
                    </h3>
                    <p class="text-sm text-gray-500">ë¬¸í—Œ ê¸°ë¡, ì™¸êµ ë¶„ìŸ, êµ­ì œ ì¡°ì•½ ë“± ì‚¬ê±´ì˜ ì„±ê²©ì„ ë¶„ì„í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="chart-container">
                    <canvas id="typeChart"></canvas>
                </div>
            </div>

        </section>

        <!-- Interactive Explorer Section -->
        <section class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-auto lg:h-[800px]">
            
            <!-- Left: Filter & Timeline List (5 cols) -->
            <div class="lg:col-span-5 flex flex-col bg-white rounded-lg card-shadow overflow-hidden h-[600px] lg:h-full">
                <!-- Filters -->
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <h3 class="font-bold text-gray-700 mb-3">ì—°í‘œ íƒìƒ‰ í•„í„°</h3>
                    <div class="flex flex-wrap gap-2" id="filterContainer">
                        <button onclick="filterData('all')" class="filter-btn active px-3 py-1 text-sm rounded-full bg-[#1e3a8a] text-white hover:bg-blue-800 transition">ì „ì²´</button>
                        <button onclick="filterData('Joseon')" class="filter-btn px-3 py-1 text-sm rounded-full bg-white border border-gray-300 text-gray-600 hover:bg-gray-100 transition">ì¡°ì„ ì‹œëŒ€</button>
                        <button onclick="filterData('Modern')" class="filter-btn px-3 py-1 text-sm rounded-full bg-white border border-gray-300 text-gray-600 hover:bg-gray-100 transition">ê·¼í˜„ëŒ€</button>
                        <button onclick="filterData('Japan')" class="filter-btn px-3 py-1 text-sm rounded-full bg-white border border-gray-300 text-gray-600 hover:bg-gray-100 transition">ì¼ë³¸ì¸¡ ê¸°ë¡/ì‚¬ê±´</button>
                    </div>
                </div>

                <!-- Timeline List -->
                <div id="timelineList" class="flex-grow overflow-y-auto custom-scroll relative p-4">
                    <div class="timeline-line"></div>
                    <!-- Items will be injected here via JS -->
                </div>
            </div>

            <!-- Right: Detail View (7 cols) -->
            <div class="lg:col-span-7 flex flex-col">
                <div id="detailView" class="bg-white rounded-lg card-shadow h-full p-8 flex flex-col justify-center items-center text-center transition-all duration-300 sticky top-4">
                    <!-- Default State -->
                    <div class="text-gray-400">
                        <span class="text-6xl block mb-4">ğŸ‘ˆ</span>
                        <p class="text-xl">ì—°í‘œì—ì„œ ì‚¬ê±´ì„ ì„ íƒí•˜ì—¬<br>ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                    </div>
                </div>
            </div>

        </section>

    </main>

    <footer class="bg-gray-800 text-gray-400 py-6 mt-8">
        <div class="container mx-auto px-4 text-center text-sm">
            <p>Â© 2024 Dokdo History Interactive Analytics. Data based on historical records provided.</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- 1. Data Store ---
        // Data derived from the provided source report.
        // Categories added for analytical purposes.
        const timelineData = [
            { year: 1454, title: "ì„¸ì¢…ì‹¤ë¡ì§€ë¦¬ì§€", content: "ìš°ì‚°(ë…ë„)ê³¼ ë¬´ë¦‰(ìš¸ë¦‰ë„)ì´ ê°•ì›ë„ ìš¸ì§„í˜„ì— ì†í•œë‹¤ê³  ê¸°ë¡í•¨. ë…ë„ê°€ í•œêµ­ì˜ ì˜í† ì„ì„ ì…ì¦í•˜ëŠ” ê°€ì¥ ì˜¤ë˜ëœ ê´€ì°¬ ë¬¸í—Œ ì¤‘ í•˜ë‚˜.", type: "Korean Record", era: "Joseon", icon: "ğŸ“œ" },
            { year: 1531, title: "ì‹ ì¦ë™êµ­ì—¬ì§€ìŠ¹ëŒ", content: "ë…ë„ê°€ ìš°ë¦¬ ì˜í† ì„ì„ ë°íˆëŠ” ê´€ì°¬ ì§€ë¦¬ì§€ í¸ì°¬. ì¡°ì„  ì „ê¸°ì˜ ì§€ë¦¬ ì¸ì‹ì„ ë³´ì—¬ì£¼ëŠ” ì¤‘ìš”í•œ ìë£Œ.", type: "Korean Record", era: "Joseon", icon: "ğŸ“˜" },
            { year: 1667, title: "ì€ì£¼ì‹œì²­í•©ê¸°", content: "ì¼ë³¸ì˜ ë¬¸í—Œ. ìš¸ë¦‰ë„ì™€ ë…ë„ê°€ ì¼ë³¸ ì˜í†  ë°–, ì¦‰ ì¡°ì„  ë•…ì„ì„ ì¼ë³¸ ìŠ¤ìŠ¤ë¡œ ê¸°ë¡í•œ ìµœì´ˆì˜ ë¬¸í—Œ.", type: "Japanese Record", era: "Joseon", icon: "ğŸ‡¯ğŸ‡µ" },
            { year: 1693, title: "1ì°¨ ì•ˆìš©ë³µ ì‚¬ê±´", content: "ì•ˆìš©ë³µì´ ì¼ë³¸ìœ¼ë¡œ ëŒë ¤ê°€ ë…ë„ê°€ ì¡°ì„  ë•…ì„ì„ ê°•ë ¥íˆ ì£¼ì¥í•˜ê³  ëŒì•„ì˜´. ë¯¼ê°„ ì°¨ì›ì˜ ì˜í†  ìˆ˜í˜¸ í™œë™.", type: "Incident", era: "Joseon", icon: "ğŸš£" },
            { year: 1696, title: "2ì°¨ ì•ˆìš©ë³µ ì‚¬ê±´", content: "ì•ˆìš©ë³µì´ ì¼ë³¸ì— ê±´ë„ˆê°€ ë¶ˆë²• ì¹¨ë²”ì— í•­ì˜í•¨. ì´ì— ì¼ë³¸ ë§‰ë¶€ê°€ 'ìš¸ë¦‰ë„ ë„í•´ ê¸ˆì§€ë ¹'ì„ ë‚´ë ¤ ì¡°ì„  ì˜í† ì„ì„ ì¸ì •í•¨.", type: "Incident", era: "Joseon", icon: "ğŸš«" },
            { year: 1785, title: "ì‚¼êµ­ì ‘ì–‘ì§€ë„", content: "ì¼ë³¸ í•™ì í•˜ì•¼ì‹œ ì‹œí—¤ì´ê°€ ì œì‘í•œ ì§€ë„. ë…ë„ë¥¼ ì¡°ì„ ìƒ‰(í™©ìƒ‰)ìœ¼ë¡œ ì¹ í•˜ê³  ì˜†ì— 'ì¡°ì„ ì˜ ê²ƒ'ì´ë¼ê³  ëª…ê¸°í•¨.", type: "Map/Geo", era: "Joseon", icon: "ğŸ—ºï¸" },
            { year: 1877, title: "íƒœì •ê´€ ì§€ë ¹", content: "ì¼ë³¸ ìµœê³  í–‰ì •ê¸°ê´€ì¸ íƒœì •ê´€ì´ 'ë…ë„ì™€ ìš¸ë¦‰ë„ëŠ” ì¼ë³¸ê³¼ ê´€ê³„ì—†ë‹¤'ê³  ê³µì‹ì ìœ¼ë¡œ ì¸ì •í•˜ê³  ì§€ë ¹ì„ ë‚´ë¦¼.", type: "Japanese Admin", era: "Modern", icon: "ğŸ›ï¸" },
            { year: 1900, title: "ëŒ€í•œì œêµ­ ì¹™ë ¹ 41í˜¸", content: "ê³ ì¢… í™©ì œê°€ ë…ë„ë¥¼ ìš¸ë¦‰êµ°ì˜ ê´€í•  êµ¬ì—­ìœ¼ë¡œ ê³µì‹ ë°˜í¬í•¨. ê·¼ëŒ€ êµ­ì œë²•ì ìœ¼ë¡œ ì˜ìœ ê¶Œì„ ì¬í™•ì¸í•œ ì¡°ì¹˜.", type: "Korean Law", era: "Modern", icon: "ğŸ‘‘" },
            { year: 1905, title: "ì‹œë§ˆë„¤í˜„ ê³ ì‹œ 40í˜¸", content: "ì¼ë³¸ì´ ëŸ¬ì¼ì „ìŸ ì¤‘ êµ°ì‚¬ì  ëª©ì ìœ¼ë¡œ ë…ë„ë¥¼ ë¶ˆë²•ì ìœ¼ë¡œ 'ë‹¤ì¼€ì‹œë§ˆ'ë¡œ í¸ì…í•œë‹¤ê³  ì¼ë°©ì ìœ¼ë¡œ ê³ ì‹œí•¨.", type: "Japanese Admin", era: "Modern", icon: "âš”ï¸" },
            { year: 1906, title: "ì‹¬í¥íƒ ë³´ê³ ì„œ", content: "ìš¸ë¦‰êµ°ìˆ˜ ì‹¬í¥íƒì´ ë…ë„ê°€ ì¼ë³¸ì— í¸ì…ë˜ì—ˆë‹¤ëŠ” ì†Œì‹ì„ ë“£ê³  ì¦‰ê° ì¤‘ì•™ ì •ë¶€ì— ë³´ê³ í•˜ì—¬ ë¶€ë‹¹í•¨ì„ ì•Œë¦¼.", type: "Korean Record", era: "Modern", icon: "ğŸ“" },
            { year: 1946, title: "SCAPIN ì œ677í˜¸", content: "ì—°í•©êµ°ìµœê³ ì‚¬ë ¹ê´€ ì§€ë ¹(SCAPIN)ìœ¼ë¡œ ë…ë„ë¥¼ ì¼ë³¸ì˜ í†µì¹˜ê¶Œ ë° í–‰ì •ê¶Œì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ì œì™¸í•¨.", type: "International", era: "Modern", icon: "âš–ï¸" },
            { year: 1951, title: "ìƒŒí”„ë€ì‹œìŠ¤ì½” ê°•í™”ì¡°ì•½", content: "ì¼ë³¸ì´ í•œêµ­ì˜ ë…ë¦½ì„ ì¸ì •í•¨. ê·¸ëŸ¬ë‚˜ ë…ë„ ëª…ì‹œê°€ ëˆ„ë½ë˜ì–´ ì´í›„ ë¶„ìŸì˜ ì”¨ì•—ì´ ë¨.", type: "International", era: "Modern", icon: "ğŸ¤" },
            { year: 1952, title: "í‰í™”ì„  ì„ í¬", content: "ì´ìŠ¹ë§Œ ëŒ€í†µë ¹ì´ ë…ë„ë¥¼ í¬í•¨í•œ ì¸ì ‘ í•´ì–‘ì— ëŒ€í•œ ì£¼ê¶Œì„ ì„ ì–¸(í‰í™”ì„ ).", type: "Korean Policy", era: "Modern", icon: "ğŸŒŠ" },
            { year: 1953, title: "ë…ë„ì˜ìš©ìˆ˜ë¹„ëŒ€ í™œë™", content: "í™ìˆœì¹  ë“± ë¯¼ê°„ì¸ë“¤ì´ ë…ë„ì— ìƒì£¼í•˜ë©° ë¬´ì¥í•˜ì—¬ ì¼ë³¸ì˜ ì¹¨ë²”ì„ ë§‰ì•„ëƒ„.", type: "Civil Activity", era: "Modern", icon: "ğŸ›¡ï¸" },
            { year: 1965, title: "í•œì¼ê¸°ë³¸ì¡°ì•½", content: "í•œì¼ êµ­êµ ì •ìƒí™” ê³¼ì •ì—ì„œ ë…ë„ ë¬¸ì œë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•˜ì§€ ì•Šê³  ë´‰í•©í•¨. ê°ˆë“±ì´ ì ë³µí•˜ëŠ” ê³„ê¸°.", type: "Diplomacy", era: "Modern", icon: "âœï¸" },
            { year: 1998, title: "ì‹ í•œì¼ì–´ì—…í˜‘ì •", content: "ë…ë„ê°€ í•œì¼ ì¤‘ê°„ìˆ˜ì—­ì— í¬í•¨ë˜ë©´ì„œ ì–´ì—…ê¶Œ ë° ì˜ìœ ê¶Œ ê´€ë ¨ ë…¼ë€ì´ ë°œìƒí•¨.", type: "Diplomacy", era: "Modern", icon: "ğŸŸ" },
            { year: 2005, title: "ë‹¤ì¼€ì‹œë§ˆì˜ ë‚  ì œì •", content: "ì¼ë³¸ ì‹œë§ˆë„¤í˜„ì´ 2ì›” 22ì¼ì„ 'ë‹¤ì¼€ì‹œë§ˆì˜ ë‚ 'ë¡œ ì œì •í•˜ì—¬ ì˜ìœ ê¶Œ ì£¼ì¥ì„ ë…¸ê³¨í™”í•¨.", type: "Japanese Admin", era: "Modern", icon: "ğŸ“†" },
            { year: 2011, title: "ì¼ë³¸ êµê³¼ì„œ ì™œê³¡", content: "ì¼ë³¸ ì¤‘í•™êµ êµê³¼ì„œ 14ì¢…ì— ë…ë„ ì˜ìœ ê¶Œ ì£¼ì¥ì´ ê¸°ìˆ ë¨. êµìœ¡ì„ í†µí•œ ì—­ì‚¬ ì™œê³¡ ì‹¬í™”.", type: "Japanese Education", era: "Modern", icon: "ğŸ“š" }
        ];

        // --- 2. State Management ---
        let currentFilter = 'all';
        let selectedId = null;

        // --- 3. Chart Initialization ---
        function initCharts() {
            // Data Processing for Charts
            // 1. By Century (approximate grouping for visualization)
            const centuryCounts = { '15ì„¸ê¸°': 0, '16ì„¸ê¸°': 0, '17ì„¸ê¸°': 0, '18ì„¸ê¸°': 0, '19ì„¸ê¸°': 0, '20ì„¸ê¸° ì´í›„': 0 };
            
            timelineData.forEach(d => {
                if (d.year < 1500) centuryCounts['15ì„¸ê¸°']++;
                else if (d.year < 1600) centuryCounts['16ì„¸ê¸°']++;
                else if (d.year < 1700) centuryCounts['17ì„¸ê¸°']++;
                else if (d.year < 1800) centuryCounts['18ì„¸ê¸°']++;
                else if (d.year < 1900) centuryCounts['19ì„¸ê¸°']++;
                else centuryCounts['20ì„¸ê¸° ì´í›„']++;
            });

            // 2. By Type Category (Simplified)
            const typeCounts = { 'í•œêµ­ì¸¡ ê¸°ë¡/í™œë™': 0, 'ì¼ë³¸ì¸¡ ê¸°ë¡/ì£¼ì¥': 0, 'êµ­ì œ/ì™¸êµ': 0 };
            timelineData.forEach(d => {
                if (d.type.includes('Korean') || d.type.includes('Civil') || d.type === 'Incident') typeCounts['í•œêµ­ì¸¡ ê¸°ë¡/í™œë™']++;
                else if (d.type.includes('Japanese') || d.type === 'Map/Geo') typeCounts['ì¼ë³¸ì¸¡ ê¸°ë¡/ì£¼ì¥']++;
                else typeCounts['êµ­ì œ/ì™¸êµ']++;
            });

            // Chart 1: Timeline Bar Chart
            const ctx1 = document.getElementById('timelineChart').getContext('2d');
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: Object.keys(centuryCounts),
                    datasets: [{
                        label: 'ì‚¬ê±´/ê¸°ë¡ ìˆ˜',
                        data: Object.values(centuryCounts),
                        backgroundColor: 'rgba(30, 58, 138, 0.7)',
                        borderColor: 'rgba(30, 58, 138, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 1 } }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: (context) => `${context.raw}ê±´ì˜ ì£¼ìš” ê¸°ë¡` } }
                    }
                }
            });

            // Chart 2: Type Doughnut Chart
            const ctx2 = document.getElementById('typeChart').getContext('2d');
            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(typeCounts),
                    datasets: [{
                        data: Object.values(typeCounts),
                        backgroundColor: [
                            '#3b82f6', // Korean - Blue
                            '#ef4444', // Japanese - Red
                            '#fbbf24'  // Intl - Amber
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { boxWidth: 12, font: { size: 11 } } }
                    }
                }
            });
        }

        // --- 4. Render Logic ---
        function renderTimeline() {
            const listContainer = document.getElementById('timelineList');
            listContainer.innerHTML = '<div class="timeline-line"></div>'; // Reset and keep line

            const filteredData = timelineData.filter(item => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'Joseon') return item.era === 'Joseon';
                if (currentFilter === 'Modern') return item.era === 'Modern';
                if (currentFilter === 'Japan') return item.type.includes('Japanese') || item.type === 'Map/Geo';
                return true;
            });

            filteredData.forEach((item, index) => {
                const isSelected = selectedId === index;
                
                const el = document.createElement('div');
                el.className = `relative pl-10 py-3 cursor-pointer group transition-all duration-200 ${isSelected ? 'scale-[1.02]' : 'hover:pl-11'}`;
                el.onclick = () => selectEvent(item, index);

                // Dot on timeline
                const dot = document.createElement('div');
                dot.className = `absolute left-[19px] top-6 w-3 h-3 rounded-full border-2 border-white shadow-sm z-10 transition-colors ${isSelected ? 'bg-[#1e3a8a] scale-125' : 'bg-gray-300 group-hover:bg-blue-400'}`;
                
                // Content Card
                const card = document.createElement('div');
                card.className = `p-3 rounded-lg border-l-4 shadow-sm transition-all ${isSelected ? 'bg-blue-50 border-[#1e3a8a]' : 'bg-white border-transparent hover:shadow-md'}`;
                
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <span class="text-xs font-bold text-gray-500 bg-gray-100 px-2 py-0.5 rounded">${item.year}</span>
                        <span class="text-xs text-gray-400">${item.type}</span>
                    </div>
                    <h4 class="font-bold text-gray-800 mt-1">${item.title}</h4>
                    <p class="text-xs text-gray-500 truncate mt-1">${item.content}</p>
                `;

                el.appendChild(dot);
                el.appendChild(card);
                listContainer.appendChild(el);
            });
        }

        function selectEvent(item, index) {
            selectedId = index;
            renderTimeline(); // Re-render to update highlights

            const detailView = document.getElementById('detailView');
            
            // Generate detailed view content
            // Using different colors for types
            let badgeColor = "bg-gray-100 text-gray-600";
            if(item.type.includes("Korean")) badgeColor = "bg-blue-100 text-blue-800";
            if(item.type.includes("Japanese")) badgeColor = "bg-red-100 text-red-800";

            detailView.innerHTML = `
                <div class="w-full h-full flex flex-col items-start text-left animate-fade-in">
                    <div class="w-full flex justify-between items-center border-b pb-4 mb-6">
                        <div class="flex items-center gap-3">
                            <span class="text-4xl shadow-sm rounded-full bg-white p-2">${item.icon}</span>
                            <div>
                                <h2 class="text-3xl font-bold serif-font text-[#1e3a8a]">${item.year}ë…„</h2>
                                <span class="text-sm font-semibold ${badgeColor} px-2 py-1 rounded">${item.type}</span>
                            </div>
                        </div>
                        <div class="text-right hidden md:block">
                            <span class="text-sm text-gray-400">ì‹œëŒ€ êµ¬ë¶„</span>
                            <p class="font-medium text-gray-600">${item.era === 'Joseon' ? 'ì¡°ì„ ì‹œëŒ€' : 'ê·¼í˜„ëŒ€'}</p>
                        </div>
                    </div>
                    
                    <h1 class="text-2xl font-bold text-gray-900 mb-6">${item.title}</h1>
                    
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-100 w-full mb-6">
                        <h3 class="text-sm font-bold text-gray-500 mb-2 uppercase tracking-wider">ì£¼ìš” ë‚´ìš© (Summary)</h3>
                        <p class="text-lg text-gray-800 leading-relaxed font-serif">
                            ${item.content}
                        </p>
                    </div>

                    <div class="mt-auto pt-6 border-t w-full flex justify-between items-center text-sm text-gray-500">
                        <span>ì—­ì‚¬ì  ì¤‘ìš”ë„: â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</span>
                        <button class="text-blue-600 hover:text-blue-800 font-bold" onclick="selectEventByOffset(1)">ë‹¤ìŒ ì‚¬ê±´ ë³´ê¸° â†’</button>
                    </div>
                </div>
            `;
        }
        
        // Helper to navigate via Detail View buttons
        function selectEventByOffset(offset) {
            if (selectedId === null) return;
            const nextIndex = selectedId + offset;
            if (nextIndex >= 0 && nextIndex < timelineData.length) {
                selectEvent(timelineData[nextIndex], nextIndex);
                // Scroll into view logic could go here
            }
        }

        // --- 5. Filter Logic ---
        function filterData(filterType) {
            currentFilter = filterType;
            selectedId = null; // Reset selection on filter change
            
            // Update buttons
            const buttons = document.querySelectorAll('.filter-btn');
            buttons.forEach(btn => {
                // Determine if this is the clicked button based on text/onclick content logic
                // Simple workaround: Remove active class from all, add to clicked target in cleaner React way, 
                // but here we just re-style based on match.
                btn.classList.remove('bg-[#1e3a8a]', 'text-white');
                btn.classList.add('bg-white', 'text-gray-600');
            });
            
            // Highlight active button (Visual logic only for this demo)
            const activeBtn = Array.from(buttons).find(b => b.getAttribute('onclick').includes(filterType));
            if(activeBtn) {
                activeBtn.classList.remove('bg-white', 'text-gray-600');
                activeBtn.classList.add('bg-[#1e3a8a]', 'text-white');
            }

            renderTimeline();
            
            // Reset Detail View
            document.getElementById('detailView').innerHTML = `
                <div class="text-gray-400 text-center">
                    <span class="text-6xl block mb-4">ğŸ‘ˆ</span>
                    <p class="text-xl">ëª©ë¡ì´ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì‚¬ê±´ì„ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                </div>
            `;
        }

        // --- Initialization ---
        window.onload = function() {
            initCharts();
            renderTimeline();
        };

    </script>
</body>
</html>
